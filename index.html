<!DOCTYPE html>
<html>
<head>
  <title>Upload Image</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body style="font-family: Arial; padding: 20px;">
  <h2>Upload Your Image</h2>

  <input type="file" id="fileInput" accept="image/*"><br><br>
  <button onclick="uploadImage()">Upload</button>
  <p id="status"></p>

  <script>
    async function uploadImage() {
      const fileInput = document.getElementById("fileInput");
      const statusEl = document.getElementById("status");

      if (!fileInput.files.length) {
        alert("Please select an image.");
        return;
      }

      const file = fileInput.files[0];
      console.log("Selected file:", file.name, file.type);

      try {
        const apiUrl = `https://t83rmp2h8i.execute-api.eu-central-1.amazonaws.com/post_function?content_type=${encodeURIComponent(file.type)}`;
        console.log("Fetching presigned URL from:", apiUrl);

        const response = await fetch(apiUrl);
        if (!response.ok) throw new Error(`API call failed: ${response.status}`);

        const data = await response.json();
        console.log("Presigned URL:", data.upload_url);

        const upload = await fetch(data.upload_url, {
          method: "PUT",
          headers: { "Content-Type": file.type },
          body: file
        });

        if (upload.ok) {
          console.log("✅ Upload successful");
          statusEl.textContent = "✅ Upload successful!";
        } else {
          console.error("❌ Upload failed:", upload.status);
          statusEl.textContent = "❌ Upload failed.";
        }

      } catch (err) {
        console.error("❌ Error:", err);
        statusEl.textContent = "❌ Upload failed (check console).";
      }
    }
  </script>
</body>
</html>
